Employees_firms_0_1_yrs,
employees_firms_2_3_yrs,
employees_firms_4_5_yrs,
na.rm = TRUE
) / sum(total_jobs, na.rm = TRUE)
),
by = .(tract_fips)
]#[cbsaname != ""] #removing all census tracts that are not in a CBSA
# National average YFES
yfes_by_tract <- yfes_by_tract[, Natl_avg_yfes := sum(young_firm_employees, na.rm = TRUE) / sum(total_jobs, na.rm = TRUE)]
View(tract_data)
View(lodes_by_tract)
lodes_by_block <- fread("data/LODES_data_by_block.csv")
# Summarize by tract, then filter to C000 (total employees) > 100
lodes_by_tract <- lodes_by_block[, `:=` (tract_fips = substr(w_geocode, 1, 11),
county_fips = substr(w_geocode, 1, 5))][C000 >= 100]
setnames(lodes_by_tract, old = c("C000", "CFA01", "CFA02", "CFA03", "CFA04", "CFA05"   #, "CD01", "CD02", "CD03", "CD04"
),
new = c("total_jobs", "Employees_firms_0_1_yrs", "employees_firms_2_3_yrs", "employees_firms_4_5_yrs", "employees_firms_6_10_yrs", "employees_firms_11_plus_yrs"
#, "employees_less_than_high_school", "employees_high_school_grad", "employees_some_college", "employees_bachelor_plus"
))
yfes_by_tract <- lodes_by_tract[
, .(
total_jobs = sum(total_jobs, na.rm = TRUE),
young_firm_employees = sum(
Employees_firms_0_1_yrs,
employees_firms_2_3_yrs,
employees_firms_4_5_yrs,
na.rm = TRUE
),
yfes = sum(
Employees_firms_0_1_yrs,
employees_firms_2_3_yrs,
employees_firms_4_5_yrs,
na.rm = TRUE
) / sum(total_jobs, na.rm = TRUE)
),
by = .(tract_fips, year)
]#[cbsaname != ""] #removing all census tracts that are not in a CBSA
tract_data <- fread("data/merged_tract_data.csv", colClasses = list(
`Census Tract FIPS code` = "character",
state_fips = "character",
county_fips = "character"
))
tract_data <- fread("data/merged_tract_data.csv", colClasses = list(
"character" = `Census Tract FIPS code`,
"character" = state_fips,
"character" = county_fips
))
tract_data <- fread("data/merged_tract_data.csv", colClasses = list(
"character" = "Census Tract FIPS code",
"character" = "state_fips",
"character" = "county_fips"
))
tract_data <- fread("data/merged_tract_data.csv", colClasses = list(
"character" = "Census Tract FIPS code",
"character" = "CBSA.Code"
))
yfes_by_tract <- lodes_by_tract[
, .(
total_jobs = sum(total_jobs, na.rm = TRUE),
young_firm_employees = sum(
Employees_firms_0_1_yrs,
employees_firms_2_3_yrs,
employees_firms_4_5_yrs,
na.rm = TRUE
),
yfes = sum(
Employees_firms_0_1_yrs,
employees_firms_2_3_yrs,
employees_firms_4_5_yrs,
na.rm = TRUE
) / sum(total_jobs, na.rm = TRUE),
Metropolitan/Micropolitan.Statistical.Area = Metropolitan/Micropolitan.Statistical.Area
yfes_by_tract <- lodes_by_tract[
, .(
total_jobs = sum(total_jobs, na.rm = TRUE),
young_firm_employees = sum(
Employees_firms_0_1_yrs,
employees_firms_2_3_yrs,
employees_firms_4_5_yrs,
na.rm = TRUE
),
yfes = sum(
Employees_firms_0_1_yrs,
employees_firms_2_3_yrs,
employees_firms_4_5_yrs,
na.rm = TRUE
) / sum(total_jobs, na.rm = TRUE),
Metropolitan/Micropolitan.Statistical.Area = Metropolitan/Micropolitan.Statistical.Area
yfes_by_tract <- lodes_by_tract[
, .(
total_jobs = sum(total_jobs, na.rm = TRUE),
young_firm_employees = sum(
Employees_firms_0_1_yrs,
employees_firms_2_3_yrs,
employees_firms_4_5_yrs,
na.rm = TRUE
),
yfes = sum(
Employees_firms_0_1_yrs,
employees_firms_2_3_yrs,
employees_firms_4_5_yrs,
na.rm = TRUE
) / sum(total_jobs, na.rm = TRUE),
`Metropolitan/Micropolitan.Statistical.Area` = `Metropolitan/Micropolitan.Statistical.Area`
),
by = .(tract_fips, year)
]#[cbsaname != ""] #removing all census tracts that are not in a CBSA
tract_data <- fread("data/merged_tract_data.csv", colClasses = list(
"character" = "Census Tract FIPS code",
"character" = "CBSA.Code"
))
merged_tracts_yfes <- merge(tract_data,
yfes_by_tract[, .(tract_fips, year, yfes, Natl_avg_yfes)],
by.x = "Census Tract FIPS code",
by.y = "tract_fips",
all.x = TRUE) ### check this later
tract_data <- fread("data/merged_tract_data.csv", colClasses = list(
"character" = "w_geocode",
"character" = "Census Tract FIPS code",
"character" = "CBSA.Code"
))
tract_data <- fread("data/merged_tract_data.csv", colClasses = list(
"character" = "w_geocode",
"character" = "Census Tract FIPS code",
"character" = "CBSA.Code"
))
lodes_by_block <- fread("data/LODES_data_by_block.csv", colClasses = list(
"character" = "w_geocode",
"character" = "trct"
))
# Summarize by tract, then filter to C000 (total employees) > 100
lodes_by_tract <- lodes_by_block[, `:=` (tract_fips = substr(w_geocode, 1, 11),
county_fips = substr(w_geocode, 1, 5))][C000 >= 100]
lodes_by_block[, w_geocode := sprintf("%015s", w_geocode)]
# Summarize by tract, then filter to C000 (total employees) > 100
lodes_by_tract <- lodes_by_block[, `:=` (tract_fips = substr(w_geocode, 1, 11),
county_fips = substr(w_geocode, 1, 5))][C000 >= 100]
setnames(lodes_by_tract, old = c("C000", "CFA01", "CFA02", "CFA03", "CFA04", "CFA05"   #, "CD01", "CD02", "CD03", "CD04"
),
new = c("total_jobs", "Employees_firms_0_1_yrs", "employees_firms_2_3_yrs", "employees_firms_4_5_yrs", "employees_firms_6_10_yrs", "employees_firms_11_plus_yrs"
#, "employees_less_than_high_school", "employees_high_school_grad", "employees_some_college", "employees_bachelor_plus"
))
tract_data <- fread("data/merged_tract_data.csv", colClasses = list(
"character" = "w_geocode",
"character" = "Census Tract FIPS code",
"character" = "CBSA.Code"
))
tract_data <- fread("data/merged_tract_data.csv", colClasses = list(
"character" = "Census Tract FIPS code",
"character" = "CBSA.Code"
))
tract_data <- tract_data[lodes_by_tract, on = .(`Census Tract FIPS code` = tract_fips), nomatch = 0]
tract_data <- lodes_by_tract[tract_data, on = .(tract_fips = `Census Tract FIPS code`), nomatch = 0]
tract_data <- lodes_by_tract[tract_data, on = .(tract_fips = `Census Tract FIPS code`, year = Year), nomatch = 0]
tract_data <- fread("data/merged_tract_data.csv", colClasses = list(
"character" = "Census Tract FIPS code",
"character" = "CBSA.Code"
))
merged_tract_data <- lodes_by_tract[tract_data, on = .(tract_fips = `Census Tract FIPS code`, year = Year), nomatch = 0]
yfes_by_tract <- merged_tract_data[
, .(
total_jobs = sum(total_jobs, na.rm = TRUE),
young_firm_employees = sum(
Employees_firms_0_1_yrs,
employees_firms_2_3_yrs,
employees_firms_4_5_yrs,
na.rm = TRUE
),
yfes = sum(
Employees_firms_0_1_yrs,
employees_firms_2_3_yrs,
employees_firms_4_5_yrs,
na.rm = TRUE
) / sum(total_jobs, na.rm = TRUE)
),
by = .(tract_fips, year)
]#[cbsaname != ""] #removing all census tracts that are not in a CBSA
View(yfes_by_tract)
yfes_by_tract <- merged_tract_data[
, .(
total_jobs = sum(total_jobs, na.rm = TRUE),
young_firm_employees = sum(
Employees_firms_0_1_yrs,
employees_firms_2_3_yrs,
employees_firms_4_5_yrs,
na.rm = TRUE
),
yfes = sum(
Employees_firms_0_1_yrs,
employees_firms_2_3_yrs,
employees_firms_4_5_yrs,
na.rm = TRUE
) / sum(total_jobs, na.rm = TRUE),
`Metropolitan/Micropolitan.Statistical.Area` = `Metropolitan/Micropolitan.Statistical.Area`
),
by = .(tract_fips, year)
]#[cbsaname != ""] #removing all census tracts that are not in a CBSA
# National average YFES generally
yfes_by_tract <- yfes_by_tract[, Natl_avg_yfes := sum(young_firm_employees, na.rm = TRUE) / sum(total_jobs, na.rm = TRUE)]
yfes_by_tract <- yfes_by_tract[, avg_yfes_by_cbsa_type := sum(young_firm_employees, na.rm = TRUE) / sum(total_jobs, na.rm = TRUE), by = .( Metropolitan/Micropolitan.Statistical.Area)]
yfes_by_tract <- yfes_by_tract[, avg_yfes_by_cbsa_type := sum(young_firm_employees, na.rm = TRUE) / sum(total_jobs, na.rm = TRUE), by = .(`Metropolitan/Micropolitan.Statistical.Area`)]
View(yfes_by_tract)
merged_tract_data <- lodes_by_tract[tract_data, on = .(tract_fips = `Census Tract FIPS code`, year = Year), nomatch = 0]
yfes_by_tract <- merged_tract_data[
, .(
total_jobs = sum(total_jobs, na.rm = TRUE),
young_firm_employees = sum(
Employees_firms_0_1_yrs,
employees_firms_2_3_yrs,
employees_firms_4_5_yrs,
na.rm = TRUE
),
yfes = sum(
Employees_firms_0_1_yrs,
employees_firms_2_3_yrs,
employees_firms_4_5_yrs,
na.rm = TRUE
) / sum(total_jobs, na.rm = TRUE),
`Metropolitan/Micropolitan.Statistical.Area` = `Metropolitan/Micropolitan.Statistical.Area`
),
by = .(tract_fips, year)
]#[cbsaname != ""] #removing all census tracts that are not in a CBSA
# National average YFES generally
yfes_by_tract <- yfes_by_tract[, Natl_avg_yfes := sum(young_firm_employees, na.rm = TRUE) / sum(total_jobs, na.rm = TRUE)]
yfes_by_tract <- yfes_by_tract[, avg_yfes_by_cbsa_type := sum(young_firm_employees, na.rm = TRUE) / sum(total_jobs, na.rm = TRUE), by = .(`Metropolitan/Micropolitan.Statistical.Area`)]
yfes_by_tract[, above_natl_avg := ifelse(yfes > Natl_avg_yfes, 1, 0)]
yfes_by_tract <- merged_tract_data[
, .(
total_jobs = sum(total_jobs, na.rm = TRUE),
young_firm_employees = sum(
Employees_firms_0_1_yrs,
employees_firms_2_3_yrs,
employees_firms_4_5_yrs,
na.rm = TRUE
),
yfes = sum(
Employees_firms_0_1_yrs,
employees_firms_2_3_yrs,
employees_firms_4_5_yrs,
na.rm = TRUE
) / sum(total_jobs, na.rm = TRUE),
`Metropolitan/Micropolitan.Statistical.Area` = `Metropolitan/Micropolitan.Statistical.Area`,
population = populaiton
),
by = .(tract_fips, year)
]#[cbsaname != ""] #removing all census tracts that are not in a CBSA
yfes_by_tract <- merged_tract_data[
, .(
total_jobs = sum(total_jobs, na.rm = TRUE),
young_firm_employees = sum(
Employees_firms_0_1_yrs,
employees_firms_2_3_yrs,
employees_firms_4_5_yrs,
na.rm = TRUE
),
yfes = sum(
Employees_firms_0_1_yrs,
employees_firms_2_3_yrs,
employees_firms_4_5_yrs,
na.rm = TRUE
) / sum(total_jobs, na.rm = TRUE),
`Metropolitan/Micropolitan.Statistical.Area` = `Metropolitan/Micropolitan.Statistical.Area`,
population = population
),
by = .(tract_fips, year)
]#[cbsaname != ""] #removing all census tracts that are not in a CBSA
# National average YFES generally
yfes_by_tract <- yfes_by_tract[, Natl_avg_yfes := sum(young_firm_employees, na.rm = TRUE) / sum(total_jobs, na.rm = TRUE)]
yfes_by_tract <- yfes_by_tract[, avg_yfes_by_cbsa_type := sum(young_firm_employees, na.rm = TRUE) / sum(total_jobs, na.rm = TRUE), by = .(`Metropolitan/Micropolitan.Statistical.Area`)]
yfes_by_tract[, above_natl_avg := ifelse(yfes > Natl_avg_yfes, 1, 0)]
simple_pct_above_natl_average <- yfes_by_tract[,
.(
population_in_tracts_above_natl_avg = sum(population * above_natl_avg, na.rm = TRUE),
total_population = sum(population, na.rm = TRUE)
),
by = .(`Metropolitan/Micropolitan.Statistical.Area`, year)
]
yfes_by_tract <- merged_tract_data[
, .(
total_jobs = sum(total_jobs, na.rm = TRUE),
young_firm_employees = sum(
Employees_firms_0_1_yrs,
employees_firms_2_3_yrs,
employees_firms_4_5_yrs,
na.rm = TRUE
),
yfes = sum(
Employees_firms_0_1_yrs,
employees_firms_2_3_yrs,
employees_firms_4_5_yrs,
na.rm = TRUE
) / sum(total_jobs, na.rm = TRUE),
`Metropolitan/Micropolitan.Statistical.Area` = `Metropolitan/Micropolitan.Statistical.Area`,
population = population,
cbsaname
),
by = .(tract_fips, year)
]#[cbsaname != ""] #removing all census tracts that are not in a CBSA
merged_tract_data <- lodes_by_tract[tract_data, on = .(tract_fips = `Census Tract FIPS code`, cbsaname = CBSA.Title, year = Year), nomatch = 0]
merged_tract_data <- lodes_by_tract[tract_data, on = .(tract_fips = `Census Tract FIPS code`, cbsaname = CBSA.Title, cbsa = CBSA.Code, year = Year), nomatch = 0]
lodes_by_block <- fread("data/LODES_data_by_block.csv", colClasses = list(
"character" = "w_geocode",
"character" = "trct",
"character" = "cbsa"
))
lodes_by_block[, w_geocode := sprintf("%015s", w_geocode)]
setnames(lodes_by_tract, old = c("C000", "CFA01", "CFA02", "CFA03", "CFA04", "CFA05"   #, "CD01", "CD02", "CD03", "CD04"
),
new = c("total_jobs", "Employees_firms_0_1_yrs", "employees_firms_2_3_yrs", "employees_firms_4_5_yrs", "employees_firms_6_10_yrs", "employees_firms_11_plus_yrs"
#, "employees_less_than_high_school", "employees_high_school_grad", "employees_some_college", "employees_bachelor_plus"
))
# Summarize by tract, then filter to C000 (total employees) > 100
lodes_by_tract <- lodes_by_block[, `:=` (tract_fips = substr(w_geocode, 1, 11),
county_fips = substr(w_geocode, 1, 5))][C000 >= 100]
setnames(lodes_by_tract, old = c("C000", "CFA01", "CFA02", "CFA03", "CFA04", "CFA05"   #, "CD01", "CD02", "CD03", "CD04"
),
new = c("total_jobs", "Employees_firms_0_1_yrs", "employees_firms_2_3_yrs", "employees_firms_4_5_yrs", "employees_firms_6_10_yrs", "employees_firms_11_plus_yrs"
#, "employees_less_than_high_school", "employees_high_school_grad", "employees_some_college", "employees_bachelor_plus"
))
tract_data <- fread("data/merged_tract_data.csv", colClasses = list(
"character" = "Census Tract FIPS code",
"character" = "CBSA.Code"
))
merged_tract_data <- lodes_by_tract[tract_data, on = .(tract_fips = `Census Tract FIPS code`, cbsaname = CBSA.Title, cbsa = CBSA.Code, year = Year), nomatch = 0]
yfes_by_tract <- merged_tract_data[
, .(
total_jobs = sum(total_jobs, na.rm = TRUE),
young_firm_employees = sum(
Employees_firms_0_1_yrs,
employees_firms_2_3_yrs,
employees_firms_4_5_yrs,
na.rm = TRUE
),
yfes = sum(
Employees_firms_0_1_yrs,
employees_firms_2_3_yrs,
employees_firms_4_5_yrs,
na.rm = TRUE
) / sum(total_jobs, na.rm = TRUE),
`Metropolitan/Micropolitan.Statistical.Area` = `Metropolitan/Micropolitan.Statistical.Area`,
population = population,
cbsaname
),
by = .(tract_fips, year)
]#[cbsaname != ""] #removing all census tracts that are not in a CBSA
yfes_by_tract <- merged_tract_data[
, .(
total_jobs = sum(total_jobs, na.rm = TRUE),
young_firm_employees = sum(
Employees_firms_0_1_yrs,
employees_firms_2_3_yrs,
employees_firms_4_5_yrs,
na.rm = TRUE
),
yfes = sum(
Employees_firms_0_1_yrs,
employees_firms_2_3_yrs,
employees_firms_4_5_yrs,
na.rm = TRUE
) / sum(total_jobs, na.rm = TRUE),
`Metropolitan/Micropolitan.Statistical.Area` = `Metropolitan/Micropolitan.Statistical.Area`,
population = population,
cbsaname,
cbsa
),
by = .(tract_fips, year)
]#[cbsaname != ""] #removing all census tracts that are not in a CBSA
lodes_by_block <- fread("data/LODES_data_by_block.csv", colClasses = list(
"character" = "w_geocode",
"character" = "trct",
"character" = "cbsa"
))
lodes_by_block[,  `:=` (w_geocode = sprintf("%015s", w_geocode),
trct = sprintf("%011s", trct),
cbsa = sprintf("%005s", cbsa)
)]
# Summarize by tract, then filter to C000 (total employees) > 100
lodes_by_tract <- lodes_by_block[, `:=` (tract_fips = substr(w_geocode, 1, 11),
county_fips = substr(w_geocode, 1, 5))][C000 >= 100]
setnames(lodes_by_tract, old = c("C000", "CFA01", "CFA02", "CFA03", "CFA04", "CFA05"   #, "CD01", "CD02", "CD03", "CD04"
),
new = c("total_jobs", "Employees_firms_0_1_yrs", "employees_firms_2_3_yrs", "employees_firms_4_5_yrs", "employees_firms_6_10_yrs", "employees_firms_11_plus_yrs"
#, "employees_less_than_high_school", "employees_high_school_grad", "employees_some_college", "employees_bachelor_plus"
))
tract_data <- fread("data/merged_tract_data.csv", colClasses = list(
"character" = "Census Tract FIPS code",
"character" = "CBSA.Code"
))
merged_tract_data <- lodes_by_tract[tract_data, on = .(tract_fips = `Census Tract FIPS code`, cbsaname = CBSA.Title, cbsa = CBSA.Code, year = Year), nomatch = 0]
merged_tract_data <- lodes_by_tract[tract_data, on = .(tract_fips = `Census Tract FIPS code`, cbsaname = CBSA.Title, cbsa = CBSA.Code, year = Year), nomatch = NULL]
yfes_by_tract <- merged_tract_data[
, .(
total_jobs = sum(total_jobs, na.rm = TRUE),
young_firm_employees = sum(
Employees_firms_0_1_yrs,
employees_firms_2_3_yrs,
employees_firms_4_5_yrs,
na.rm = TRUE
),
yfes = sum(
Employees_firms_0_1_yrs,
employees_firms_2_3_yrs,
employees_firms_4_5_yrs,
na.rm = TRUE
) / sum(total_jobs, na.rm = TRUE),
`Metropolitan/Micropolitan.Statistical.Area` = `Metropolitan/Micropolitan.Statistical.Area`,
population = population,
cbsaname,
cbsa
),
by = .(tract_fips, year)
]#[cbsaname != ""] #removing all census tracts that are not in a CBSA
# National average YFES generally
yfes_by_tract <- yfes_by_tract[, Natl_avg_yfes := sum(young_firm_employees, na.rm = TRUE) / sum(total_jobs, na.rm = TRUE)]
yfes_by_tract <- yfes_by_tract[, avg_yfes_by_cbsa_type := sum(young_firm_employees, na.rm = TRUE) / sum(total_jobs, na.rm = TRUE), by = .(`Metropolitan/Micropolitan.Statistical.Area`)]
yfes_by_tract <- yfes_by_tract[, Natl_yfes_by_cbsa_type := sum(young_firm_employees, na.rm = TRUE) / sum(total_jobs, na.rm = TRUE), by = .(`Metropolitan/Micropolitan.Statistical.Area`)]
yfes_by_tract[, `:=` (above_natl_avg = fifelse(yfes > Natl_avg_yfes, 1, 0),
above_natl_avg_by_cbsa_type = fifelse(yfes > Natl_avg_yfes_by_cbsa_type))]
yfes_by_tract[, `:=` (above_natl_avg = fifelse(yfes > Natl_avg_yfes, 1, 0),
above_natl_avg_by_cbsa_type = fifelse(yfes > Natl_yfes_by_cbsa_type))]
yfes_by_tract[, `:=` (above_natl_avg = fifelse(yfes > Natl_avg_yfes, 1, 0),
above_natl_avg_by_cbsa_type = fifelse(yfes > Natl_yfes_by_cbsa_type, 1, 0))]
simple_pct_above_natl_average <- yfes_by_tract[,
.(
population_in_tracts_above_natl_avg = sum(population * above_natl_avg, na.rm = TRUE),
total_population = sum(population, na.rm = TRUE)
),
by = .(`Metropolitan/Micropolitan.Statistical.Area`, year)
]
View(simple_pct_above_natl_average)
simple_pct_above_natl_average <- yfes_by_tract[,
.(
population_in_tracts_above_natl_avg = sum(population * above_natl_avg, na.rm = TRUE),
total_population = sum(population, na.rm = TRUE)
),
by = .(`cbsaname`, year)
]
View(simple_pct_above_natl_average)
simple_pct_above_natl_average <- yfes_by_tract[,
.(
population_above_natl_avg = sum(population * above_natl_avg, na.rm = TRUE),
population_above_natl_avg_by_cbsa_type = sum(population * above_natl_avg_by_cbsa_type, na.rm = TRUE),
total_population = sum(population, na.rm = TRUE)
),
by = .(`cbsaname`, year)
]
simple_pct_above_natl_average[, `:=` (pct_above_natl_avg_simple = population_above_natl_avg / total_population,
pct_above_natl_avg_by_cbsa_type = population_above_natl_avg_by_cbsa_type / total_population)]
rm(list = ls())
lodes_by_block <- fread("data/LODES_data_by_block.csv", colClasses = list(
"character" = "w_geocode",
"character" = "trct",
"character" = "cbsa"
))
lodes_by_block[,  `:=` (w_geocode = sprintf("%015s", w_geocode),
trct = sprintf("%011s", trct),
cbsa = sprintf("%005s", cbsa)
)]
# Summarize by tract, then filter to C000 (total employees) > 100
lodes_by_tract <- lodes_by_block[, `:=` (tract_fips = substr(w_geocode, 1, 11),
county_fips = substr(w_geocode, 1, 5))][C000 >= 100]
setnames(lodes_by_tract, old = c("C000", "CFA01", "CFA02", "CFA03", "CFA04", "CFA05"   #, "CD01", "CD02", "CD03", "CD04"
),
new = c("total_jobs", "Employees_firms_0_1_yrs", "employees_firms_2_3_yrs", "employees_firms_4_5_yrs", "employees_firms_6_10_yrs", "employees_firms_11_plus_yrs"
#, "employees_less_than_high_school", "employees_high_school_grad", "employees_some_college", "employees_bachelor_plus"
))
tract_data <- fread("data/merged_tract_data.csv", colClasses = list(
"character" = "Census Tract FIPS code",
"character" = "CBSA.Code"
))
merged_tract_data <- lodes_by_tract[tract_data, on = .(tract_fips = `Census Tract FIPS code`, cbsaname = CBSA.Title, cbsa = CBSA.Code, year = Year), nomatch = NULL]
yfes_by_tract <- merged_tract_data[
, .(
total_jobs = sum(total_jobs, na.rm = TRUE),
young_firm_employees = sum(
Employees_firms_0_1_yrs,
employees_firms_2_3_yrs,
employees_firms_4_5_yrs,
na.rm = TRUE
),
yfes = sum(
Employees_firms_0_1_yrs,
employees_firms_2_3_yrs,
employees_firms_4_5_yrs,
na.rm = TRUE
) / sum(total_jobs, na.rm = TRUE),
`Metropolitan/Micropolitan.Statistical.Area` = `Metropolitan/Micropolitan.Statistical.Area`,
population = population,
cbsaname,
cbsa
),
by = .(tract_fips, year)
]#[cbsaname != ""] #removing all census tracts that are not in a CBSA
# National average YFES generally
yfes_by_tract <- yfes_by_tract[, Natl_avg_yfes := sum(young_firm_employees, na.rm = TRUE) / sum(total_jobs, na.rm = TRUE)]
yfes_by_tract <- yfes_by_tract[, Natl_yfes_by_cbsa_type := sum(young_firm_employees, na.rm = TRUE) / sum(total_jobs, na.rm = TRUE), by = .(`Metropolitan/Micropolitan.Statistical.Area`)]
yfes_by_tract[, `:=` (above_natl_avg = fifelse(yfes > Natl_avg_yfes, 1, 0),
above_natl_avg_by_cbsa_type = fifelse(yfes > Natl_yfes_by_cbsa_type, 1, 0))]
pct_above_natl_average <- yfes_by_tract[,
.(
population_above_natl_avg = sum(population * above_natl_avg, na.rm = TRUE),
population_above_natl_avg_by_cbsa_type = sum(population * above_natl_avg_by_cbsa_type, na.rm = TRUE),
total_population = sum(population, na.rm = TRUE)
),
by = .(`cbsaname`, year)
]
pct_above_natl_average[, `:=` (pct_above_natl_avg_simple = population_above_natl_avg / total_population,
pct_above_natl_avg_by_cbsa_type = population_above_natl_avg_by_cbsa_type / total_population)]
View(pct_above_natl_average)
View(yfes_by_tract)
